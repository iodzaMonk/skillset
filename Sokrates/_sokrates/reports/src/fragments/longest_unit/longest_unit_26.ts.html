<html>
<head>
    <title>export async function loginUser()</title>
    <link rel="stylesheet" charset="UTF-8" href="https://d2bb1mtyn3kglb.cloudfront.net/lib/highlight/styles/docco.min.css">
    <script charset="UTF-8" type="application/javascript" src="https://d2bb1mtyn3kglb.cloudfront.net/lib/highlight/highlight.min.js"></script>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">export async function loginUser()</h3>
<p style="margin-top: 4px">in <i>app/lib/auth/login.ts [25:73]</i></p>
<ul>
    <li><b>42</b> lines of code</li>
    <li><b>6</b> McCabe index (conditional complexity)</li>
</ul>
<pre>
<code class="ts">
export async function loginUser(body: LoginBody = {}): Promise&lt;LoginResult&gt; {
  const { email, password } = body ?? {};

  const missingFields = [
    [&quot;email&quot;, email],
    [&quot;password&quot;, password],
  ]
    .filter(([, value]) =&gt; !value)
    .map(([field]) =&gt; field);

  if (missingFields.length &gt; 0) {
    return {
      status: 400,
      body: {
        message: `Missing required fields: ${missingFields.join(&quot;, &quot;)}`,
      },
    };
  }

  const existingUser = await prisma.users.findUnique({
    where: { email },
  });

  if (!existingUser) {
    return {
      status: 401,
      body: { message: &quot;Invalid credentials&quot; },
    };
  }

  const isPasswordValid =
    typeof password === &quot;string&quot; &amp;&amp;
    typeof existingUser.password === &quot;string&quot; &amp;&amp;
    (await bcrypt.compare(password, existingUser.password));

  if (!isPasswordValid) {
    return {
      status: 401,
      body: { message: &quot;Invalid credentials&quot; },
    };
  }

  return {
    status: 200,
    body: {
      userId: existingUser.id,
    },
  };
}

</code>
</pre>
<script>
    hljs.initHighlightingOnLoad();
</script>
</body>
