<html>
<head>
    <title>app/settings/SettingsForm.tsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">app/settings/SettingsForm.tsx (<b>224</b> lines of code) (<a href="SettingsForm.tsx">raw</a>):</h3>
<div id="editor">ï»¿&quot;use client&quot;;

import { Datepicker } from &quot;flowbite-react&quot;;
import { useMemo, useRef, useState } from &quot;react&quot;;
import { format } from &quot;date-fns&quot;;
import countries from &quot;@/lib/countries.json&quot;;
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from &quot;@/components/ui/select&quot;;
import axios from &quot;axios&quot;;
import { useRouter } from &quot;next/navigation&quot;;
import { useAuth } from &quot;@/app/context/AuthContext&quot;;
import type { User } from &quot;../types/User&quot;;
import Modal from &quot;./modal&quot;;
import { ButtonMain } from &quot;../Components/Button&quot;;

const inputBase =
  &quot;block w-full rounded-md border border-border bg-surface/60 px-3 py-2 text-sm text-text placeholder:text-text-muted/70 &quot; +
  &quot;focus:outline-ring focus:ring-2 focus:ring-[--color-ring] focus:border-transparent transition&quot;;

const labelBase = &quot;mb-2 block text-sm font-medium text-text&quot;;

export function SettingsForm({ user }: { user: User }) {
  const initialBirthday = useMemo(() =&gt; {
    if (!user.birthday) return null;
    const date = new Date(user.birthday);
    return Number.isNaN(date.valueOf()) ? null : date;
  }, [user.birthday]);

  const [country, setCountry] = useState(user.country ?? &quot;&quot;);
  const [birthday, setBirthday] = useState&lt;Date | null&gt;(initialBirthday);
  const [showPassCurrent, setShowPassCurrent] = useState(false);
  const [showPassConfirm, setShowPassConfirm] = useState(false);
  const [error, setError] = useState&lt;string | null&gt;(null);
  const [isSaving, setIsSaving] = useState(false);
  const [isDeleting, setIsDeleting] = useState(false);
  const [openModal, setOpenModal] = useState(false);

  const router = useRouter();
  const { refresh, setUser } = useAuth();

  async function deleteUser() {
    if (isDeleting) return;
    setError(null);
    setIsDeleting(true);
    try {
      await axios.delete(&quot;/api/user/delete&quot;);
      setUser(null);
      router.push(&quot;/auth/signup&quot;);
    } catch (err) {
      const message = axios.isAxiosError(err)
        ? (err.response?.data?.message ?? &quot;Something went wrong&quot;)
        : &quot;Something went wrong&quot;;
      setError(message);
    } finally {
      setIsDeleting(false);
    }
  }

  async function updateUser(e: React.FormEvent&lt;HTMLFormElement&gt;) {
    e.preventDefault();
    if (isSaving) return;

    const form = new FormData(e.currentTarget);
    setError(null);
    setIsSaving(true);

    try {
      const payload = {
        id: user.id,
        email: form.get(&quot;email&quot;),
        name: form.get(&quot;name&quot;),
        password: form.get(&quot;newPassword&quot;),
        country,
        birthday,
      };
      await axios.patch(&quot;/api/user/update&quot;, payload);
      await refresh();
    } catch (err) {
      const message = axios.isAxiosError(err)
        ? (err.response?.data?.message ?? &quot;Something went wrong&quot;)
        : &quot;Something went wrong&quot;;
      setError(message);
    } finally {
      setIsSaving(false);
    }
  }

  return (
    &lt;div className=&quot;bg-surface border-border mx-auto my-20 min-h-[30vh] w-4/5 rounded border p-20&quot;&gt;
      &lt;h1 className=&quot;pt-5 text-center text-7xl&quot;&gt;Settings&lt;/h1&gt;
      &lt;form className=&quot;mx-auto w-full space-y-6&quot; onSubmit={updateUser}&gt;
        &lt;h1 className=&quot;mt-10 text-center text-4xl&quot;&gt;Edit User Info&lt;/h1&gt;
        &lt;div className=&quot;bg-text my-10 h-0.5 w-full rounded-2xl&quot; /&gt;
        &lt;div&gt;
          &lt;label htmlFor=&quot;email&quot; className={labelBase}&gt;
            Email address
          &lt;/label&gt;
          &lt;input
            name=&quot;email&quot;
            type=&quot;email&quot;
            className={inputBase}
            placeholder=&quot;you@example.com&quot;
            defaultValue={user.email ?? &quot;&quot;}
            required
            autoComplete=&quot;email&quot;
          /&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;label htmlFor=&quot;name&quot; className={labelBase}&gt;
            Name
          &lt;/label&gt;
          &lt;input
            type=&quot;text&quot;
            name=&quot;name&quot;
            className={inputBase}
            placeholder=&quot;Jane&quot;
            defaultValue={user.name ?? &quot;&quot;}
            required
            autoComplete=&quot;given-name&quot;
          /&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;label htmlFor=&quot;password&quot; className={labelBase}&gt;
            Current password
          &lt;/label&gt;
          &lt;div className=&quot;flex items-center gap-5&quot;&gt;
            &lt;input
              type={showPassCurrent ? &quot;text&quot; : &quot;password&quot;}
              name=&quot;password&quot;
              className={inputBase}
              placeholder=&quot;********&quot;
              autoComplete=&quot;new-password&quot;
            /&gt;
            &lt;button
              type=&quot;button&quot;
              className=&quot;text-text hover:text-accent&quot;
              onClick={() =&gt; setShowPassCurrent((prev) =&gt; !prev)}
            &gt;
              {showPassCurrent ? &quot;Hide&quot; : &quot;Show&quot;}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;label htmlFor=&quot;newPassword&quot; className={labelBase}&gt;
            New password
          &lt;/label&gt;
          &lt;div className=&quot;flex items-center gap-5&quot;&gt;
            &lt;input
              type={showPassConfirm ? &quot;text&quot; : &quot;password&quot;}
              name=&quot;newPassword&quot;
              className={inputBase}
              placeholder=&quot;********&quot;
              autoComplete=&quot;new-password&quot;
            /&gt;
            &lt;button
              type=&quot;button&quot;
              className=&quot;text-text hover:text-accent&quot;
              onClick={() =&gt; setShowPassConfirm((prev) =&gt; !prev)}
            &gt;
              {showPassConfirm ? &quot;Hide&quot; : &quot;Show&quot;}
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div id=&quot;countries&quot;&gt;
          &lt;label
            htmlFor=&quot;countries&quot;
            className=&quot;text-text mb-2 block text-sm font-medium&quot;
          &gt;
            Country
          &lt;/label&gt;

          &lt;Select value={country} onValueChange={setCountry}&gt;
            &lt;SelectTrigger className=&quot;bg-surface w-full&quot;&gt;
              &lt;SelectValue placeholder=&quot;Country&quot; /&gt;
            &lt;/SelectTrigger&gt;
            &lt;SelectContent
              position=&quot;popper&quot;
              side=&quot;bottom&quot;
              align=&quot;start&quot;
              sideOffset={6}
              className=&quot;border-border bg-surface text-text z-[9999] rounded-md border shadow-xl&quot;
            &gt;
              {countries.map((c) =&gt; (
                &lt;SelectItem
                  className=&quot;data-[highlighted]:!bg-accent/20 data-[highlighted]:!text-text data-[state-checked]:!bg-accent data-[state-checked]:!text-text-onAccent cursor-pointer px-3 py-2 text-sm data-[disabled]:opacity-50&quot;
                  key={c.code}
                  value={c.code}
                &gt;
                  &lt;div className=&quot;flex items-center gap-2&quot;&gt;
                    &lt;span className={`fi fi-${c.code.toLowerCase()}`} /&gt;
                    {c.name}
                  &lt;/div&gt;
                &lt;/SelectItem&gt;
              ))}
            &lt;/SelectContent&gt;
          &lt;/Select&gt;
        &lt;/div&gt;

        &lt;Datepicker
          id=&quot;datepicker&quot;
          onChange={setBirthday}
          value={birthday ?? undefined}
        /&gt;
        &lt;input
          type=&quot;hidden&quot;
          name=&quot;birthday&quot;
          value={birthday ? format(birthday, &quot;yyyy-MM-dd&quot;) : &quot;&quot;}
        /&gt;

        {error ? &lt;p className=&quot;text-red-600&quot;&gt;{error}&lt;/p&gt; : null}

        &lt;div className=&quot;flex items-center space-x-4&quot;&gt;
          &lt;ButtonMain type=&quot;submit&quot; disabled={isSaving} variant=&quot;update&quot;&gt;
            Update settings
          &lt;/ButtonMain&gt;
          &lt;ButtonMain
            variant=&quot;delete&quot;
            onClick={() =&gt; setOpenModal(true)}
            disabled={isDeleting}
          &gt;
            Delete
          &lt;/ButtonMain&gt;
        &lt;/div&gt;
      &lt;/form&gt;
      &lt;div className=&quot;bg-text my-10 h-0.5 w-full rounded-2xl&quot; /&gt;

      {/* MODAL */}
      &lt;Modal
        open={openModal}
        setOpenModal={setOpenModal}
        onDelete={deleteUser}
      /&gt;
    &lt;/div&gt;
  );
}
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
