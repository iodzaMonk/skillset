<html>
<head>
    <title>app/myproduct/page.tsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">app/myproduct/page.tsx (<b>128</b> lines of code) (<a href="page.tsx">raw</a>):</h3>
<div id="editor">&quot;use client&quot;;

import axios from &quot;axios&quot;;
import { useRouter } from &quot;next/navigation&quot;;
import { FormEvent, Key, useCallback, useEffect, useState } from &quot;react&quot;;

import { useAuth } from &quot;../context/AuthContext&quot;;
import { MyProductsView, type Product } from &quot;./MyProductsView&quot;;

export default function MyProducts() {
  const router = useRouter();
  const { user } = useAuth();

  const [products, setProducts] = useState&lt;Product[]&gt;([]);
  const [isFormOpen, setIsFormOpen] = useState(false);
  const [productPendingDelete, setProductPendingDelete] =
    useState&lt;Product | null&gt;(null);

  const [name, setName] = useState(&quot;&quot;);
  const [description, setDescription] = useState(&quot;&quot;);
  const [price, setPrice] = useState(&quot;&quot;);
  const [editingId, setEditingId] = useState&lt;Key | null&gt;(null);

  const resetForm = useCallback(() =&gt; {
    setName(&quot;&quot;);
    setDescription(&quot;&quot;);
    setPrice(&quot;&quot;);
    setEditingId(null);
  }, []);

  const fetchProducts = useCallback(async () =&gt; {
    try {
      const res = await axios.get(&quot;/api/product/user&quot;);
      setProducts(res.data?.data ?? []);
    } catch (error) {
      console.error(&quot;Failed to fetch products&quot;, error);
    }
  }, []);

  useEffect(() =&gt; {
    fetchProducts();
  }, [fetchProducts]);

  const handleFormOpenChange = useCallback(
    (nextOpen: boolean) =&gt; {
      if (!nextOpen) {
        resetForm();
      }
      setIsFormOpen(nextOpen);
    },
    [resetForm],
  );

  const handleSubmit = useCallback(
    async (event: FormEvent&lt;HTMLFormElement&gt;) =&gt; {
      event.preventDefault();

      const payload = {
        user_id: user?.id,
        title: name.trim(),
        description: description.trim(),
        price: parseFloat(price || &quot;0&quot;),
      };

      try {
        if (editingId) {
          await axios.put(&quot;/api/product/user&quot;, { ...payload, id: editingId });
        } else {
          await axios.post(&quot;/api/product/user&quot;, payload);
        }

        await fetchProducts();
        handleFormOpenChange(false);
        router.refresh();
      } catch (error) {
        console.error(&quot;Error submitting form:&quot;, error);
      }
    },
    [
      description,
      editingId,
      fetchProducts,
      handleFormOpenChange,
      name,
      price,
      router,
      user?.id,
    ],
  );

  const startEditing = useCallback((product: Product) =&gt; {
    setName(product.title);
    setDescription(product.description);
    setPrice(product.price.toString());
    setEditingId(product.id);
    setIsFormOpen(true);
  }, []);

  const requestDelete = useCallback((product: Product) =&gt; {
    setProductPendingDelete(product);
  }, []);

  const closeDeleteDialog = useCallback(() =&gt; {
    setProductPendingDelete(null);
  }, []);

  const confirmDelete = useCallback(async () =&gt; {
    if (!productPendingDelete) {
      return;
    }

    try {
      await axios.delete(&quot;/api/product&quot;, {
        data: { id: productPendingDelete.id },
      });
      await fetchProducts();
      router.refresh();
    } catch (error) {
      console.error(&quot;Failed to delete product&quot;, error);
    } finally {
      closeDeleteDialog();
    }
  }, [closeDeleteDialog, fetchProducts, productPendingDelete, router]);

  const isEditing = editingId !== null;
  const isDeleteDialogOpen = productPendingDelete !== null;

  return (
    &lt;MyProductsView
      products={products}
      isFormOpen={isFormOpen}
      isDeleteDialogOpen={isDeleteDialogOpen}
      productPendingDelete={productPendingDelete}
      name={name}
      description={description}
      price={price}
      isEditing={isEditing}
      onFormOpenChange={handleFormOpenChange}
      onSubmit={handleSubmit}
      onNameChange={setName}
      onDescriptionChange={setDescription}
      onPriceChange={setPrice}
      onStartEditing={startEditing}
      onRequestDelete={requestDelete}
      onCancelForm={() =&gt; handleFormOpenChange(false)}
      onCreateClick={resetForm}
      onCloseDeleteDialog={closeDeleteDialog}
      onConfirmDelete={confirmDelete}
    /&gt;
  );
}
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
