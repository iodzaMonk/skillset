<html>
<head>
    <title>app/myorderslist/_hooks/orderStates.ts</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">app/myorderslist/_hooks/orderStates.ts (<b>63</b> lines of code) (<a href="orderStates.ts">raw</a>):</h3>
<div id="editor">&quot;use client&quot;;

import { useCallback, useEffect, useRef, useState } from &quot;react&quot;;

import { fetchUserOrders, updateUserStatus } from &quot;@/app/lib/orders&quot;;
import { Order } from &quot;@/types/Order&quot;;
import { Status } from &quot;@/types/Status&quot;;

export function useOrderManager() {
  const [orders, setOrders] = useState&lt;Order[]&gt;([]);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedStatus, setSelectedStatus] = useState&lt;Status | null&gt;(null);
  const [selectedIds, setSelectedIds] = useState&lt;string[]&gt;([]);
  const modalRef = useRef&lt;HTMLDivElement&gt;(null);
  /**
   * Refreshes posts
   * @async
   */
  const refreshPosts = useCallback(async (): Promise&lt;void&gt; =&gt; {
    try {
      const data = await fetchUserOrders();
      // Ensure data is always an array
      setOrders(Array.isArray(data) ? data : []);
    } catch (error) {
      console.error(&quot;Unable to load orders&quot;, error);
      setOrders([]); // Set empty array on error
    }
  }, []);

  const primaryOrderId = selectedIds[0] ?? null;
  const primarOrder = orders.find((o) =&gt; o.id === primaryOrderId) ?? null;
  const openModal = useCallback(() =&gt; {
    setIsModalOpen(true);
  }, []);

  const updateStatus = useCallback(() =&gt; {
    updateUserStatus(selectedStatus, selectedIds);
  }, [selectedStatus, selectedIds]);

  const closeModal = useCallback(() =&gt; {
    updateStatus();
    refreshPosts();
    setIsModalOpen(false);
  }, [updateStatus, refreshPosts]);

  const toggleModal = useCallback(() =&gt; {
    setIsModalOpen((prev) =&gt; !prev);
  }, [setIsModalOpen]);

  useEffect(() =&gt; {
    function handlePointerDown(event: PointerEvent) {
      if (!isModalOpen) return;
      if (!modalRef.current?.contains(event.target as Node)) {
        closeModal();
      }
    }
    document.addEventListener(&quot;pointerdown&quot;, handlePointerDown);
    return () =&gt; document.removeEventListener(&quot;pointerdown&quot;, handlePointerDown);
  }, [closeModal, isModalOpen]);

  useEffect(() =&gt; {
    refreshPosts();
  }, [refreshPosts]);

  return {
    orders,
    openModal,
    closeModal,
    toggleModal,
    isModalOpen,
    modalRef,
    selectedIds,
    selectedStatus,
    setSelectedIds,
    setSelectedStatus,
    primarOrder,
  };
}
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
