<html>
<head>
    <title>app/lib/api-response.ts</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">app/lib/api-response.ts (<b>36</b> lines of code) (<a href="api-response.ts">raw</a>):</h3>
<div id="editor">import { NextResponse } from &quot;next/server&quot;;
import { Prisma } from &quot;@prisma/client&quot;;

export function unauthorizedResponse(
  referer: string,
  message: string = &quot;Not authenticated&quot;,
) {
  return NextResponse.json(
    { message },
    { status: 401, headers: { &quot;x-referer&quot;: referer } },
  );
}

export function handleApiError(error: unknown, referer: string) {
  if (
    error instanceof Prisma.PrismaClientKnownRequestError &amp;&amp;
    error.code === &quot;P2002&quot; // Unique constraint failed
  ) {
    return NextResponse.json(
      { message: &quot;Email already registered&quot; }, // Common message, or pass strictly
      { status: 409, headers: { &quot;x-referer&quot;: referer } },
    );
  }

  if (
    error instanceof Prisma.PrismaClientKnownRequestError &amp;&amp;
    error.code === &quot;P2025&quot; // Record not found
  ) {
    return NextResponse.json(
      { message: &quot;Record not found&quot; },
      { status: 404, headers: { &quot;x-referer&quot;: referer } },
    );
  }

  console.error(&quot;API Error:&quot;, error);
  return NextResponse.json(
    { message: &quot;Internal server error&quot; },
    { status: 500, headers: { &quot;x-referer&quot;: referer } },
  );
}
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
