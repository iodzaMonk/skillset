<html>
<head>
    <title>features/support/fixture-helpers.ts</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">features/support/fixture-helpers.ts (<b>51</b> lines of code) (<a href="fixture-helpers.ts">raw</a>):</h3>
<div id="editor">import { Prisma } from &quot;@prisma/client&quot;;
import bcrypt from &quot;bcryptjs&quot;;
import { randomUUID } from &quot;crypto&quot;;
import { prisma } from &quot;../../lib/prisma.ts&quot;;

export async function ensureFixtureUser(
  userId: string | null,
  name: string,
  emailPrefix: string,
): Promise&lt;{ userId: string; isNew: boolean }&gt; {
  if (userId) return { userId, isNew: false };
  const hashed = await bcrypt.hash(&quot;FixturePass123!&quot;, 10);
  const user = await prisma.users.create({
    data: {
      name,
      email: `${emailPrefix}-${randomUUID()}@example.com`,
      password: hashed,
      country: &quot;US&quot;,
    },
    select: {
      id: true,
    },
  });
  return { userId: user.id, isNew: true };
}

export async function cleanupEntities(
  prismaClient: Prisma.TransactionClient,
  options: {
    userId?: string | null;
    productIds?: string[];
    reviewIds?: string[];
    userIds?: string[];
  },
) {
  if (options.reviewIds?.length) {
    await prismaClient.reviews.deleteMany({
      where: { id: { in: options.reviewIds } },
    });
  }

  if (options.productIds?.length) {
    await prismaClient.posts.deleteMany({
      where: { id: { in: options.productIds } },
    });
  }

  const userIds = options.userIds ?? [];
  if (options.userId) userIds.push(options.userId);

  if (userIds.length &gt; 0) {
    // Delete individually to handle potential constraints or failures gracefully if needed,
    // though deleteMany is usually fine. Using deleteMany for efficiency.
    await prismaClient.users.deleteMany({
      where: { id: { in: userIds } },
    });
  }
}
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
