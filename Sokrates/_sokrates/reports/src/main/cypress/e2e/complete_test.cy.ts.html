<html>
<head>
    <title>cypress/e2e/complete_test.cy.ts</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">cypress/e2e/complete_test.cy.ts (<b>298</b> lines of code) (<a href="complete_test.cy.ts">raw</a>):</h3>
<div id="editor">import { v4 as uuidv4 } from &quot;uuid&quot;;

describe(&quot;Complete User Flow&quot;, () =&gt; {
  const appBaseUrl = &quot;http://localhost:3000&quot;;
  const uniqueId = uuidv4().substring(0, 8);
  const email = `testuser_${uniqueId}@example.com`;
  const password = &quot;password123&quot;;
  let currentUserId: string;

  const getCurrentUser = () =&gt; {
    return cy.getCookies().then((cookies) =&gt;
      cy
        .request({
          method: &quot;GET&quot;,
          url: `${appBaseUrl}/api/user/me`,
          headers: {
            Cookie: cookies
              .map((cookie) =&gt; `${cookie.name}=${cookie.value}`)
              .join(&quot;; &quot;),
          },
        })
        .then((response) =&gt; {
          currentUserId = response.body.user.id;
          return cy.wrap(response.body.user.id);
        }),
    );
  };

  const createOrderRequest = (payload: {
    description: string;
    prof_id: string;
    productId: string;
    userId: string;
  }) =&gt;
    cy.getCookies().then((cookies) =&gt;
      cy.request({
        method: &quot;POST&quot;,
        url: `${appBaseUrl}/api/orders`,
        body: payload,
        headers: {
          Cookie: cookies
            .map((cookie) =&gt; `${cookie.name}=${cookie.value}`)
            .join(&quot;; &quot;),
          &quot;Content-Type&quot;: &quot;application/json&quot;,
        },
        failOnStatusCode: false,
      }),
    );

  const clickViewDetailsFor = (productName: string) =&gt; {
    cy.contains(&quot;h2&quot;, productName, { matchCase: false })
      .should(&quot;be.visible&quot;)
      .parents('[class*=&quot;rounded-2xl&quot;]')
      .first()
      .find('a[href*=&quot;/product/&quot;]')
      .first()
      .click();
  };

  before(() =&gt; {
    cy.viewport(1280, 720);
    cy.visit(&quot;localhost:3000&quot;);
    cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
    cy.contains(&quot;Sign up&quot;).click({ force: true });

    cy.url().should(&quot;include&quot;, &quot;/auth/signup&quot;, { timeout: 10000 });
    cy.contains(&quot;Create your account&quot;).should(&quot;be.visible&quot;);

    cy.get('input[name=&quot;email&quot;]').type(email);
    cy.get('input[name=&quot;name&quot;]').type(&quot;Test User&quot;);
    cy.get('input[name=&quot;password&quot;]').first().type(password);
    cy.get('input[name=&quot;confirmPassword&quot;]').type(password);

    cy.get('[role=&quot;combobox&quot;]').click();
    cy.wait(1000);
    cy.contains('[role=&quot;option&quot;]', &quot;Australia&quot;).click();
    cy.contains(&quot;button&quot;, &quot;Submit&quot;).click();

    cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
    cy.contains(&quot;Welcome Test User&quot;).should(&quot;be.visible&quot;);

    cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
    cy.contains(&quot;Logout&quot;).should(&quot;be.visible&quot;);
    cy.contains(&quot;Logout&quot;).click({ force: true });
    cy.wait(1000);
  });

  beforeEach(() =&gt; {
    cy.viewport(1280, 720);
  });
  describe(&quot;Home Page&quot;, () =&gt; {
    it(&quot;should display home page content&quot;, () =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.contains(&quot;Discover Products&quot;);
      cy.contains(&quot;Featured Products&quot;);
    });
  });
  describe(&quot;Logout&quot;, () =&gt; {
    it(&quot;should log out the user&quot;, () =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;Login&quot;).click({ force: true });
      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();
      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Logout&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;Logout&quot;).click({ force: true });

      cy.wait(1000);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).should(&quot;be.visible&quot;);
    });
  });

  describe(&quot;Login&quot;, () =&gt; {
    it(&quot;should log in an existing user&quot;, () =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;Login&quot;).click({ force: true });

      cy.url().should(&quot;include&quot;, &quot;/auth/login&quot;, { timeout: 10000 });
      cy.contains(&quot;Sign in to your account&quot;).should(&quot;be.visible&quot;);

      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();

      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
      cy.contains(&quot;Welcome Test User&quot;).should(&quot;be.visible&quot;);
    });
  });

  describe(&quot;Stripe Vendor Account Setup&quot;, () =&gt; {
    beforeEach(() =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;Login&quot;).click({ force: true });
      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();
      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
    });

    it(&quot;should assign test vendor_id to user&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Settings&quot;).click({ force: true });
      cy.url().should(&quot;include&quot;, &quot;/settings&quot;, { timeout: 10000 });
      cy.scrollTo(&quot;bottom&quot;);
      cy.get('[data-testid=&quot;connect-stripe-button&quot;]', { timeout: 10000 })
        .should(&quot;exist&quot;)
        .should(&quot;be.visible&quot;);

      cy.getCookies().then((cookies) =&gt; {
        cy.request({
          method: &quot;POST&quot;,
          url: &quot;http://localhost:3000/api/user/test-vendor&quot;,
          body: {
            vendor_id: &quot;acct_test_cypress_123456&quot;,
          },
          headers: {
            Cookie: cookies
              .map((cookie) =&gt; `${cookie.name}=${cookie.value}`)
              .join(&quot;; &quot;),
          },
        }).then((response) =&gt; {
          expect(response.status).to.eq(200);
          expect(response.body.success).to.be.true;
        });
      });

      cy.reload();
      cy.url().should(&quot;include&quot;, &quot;/settings&quot;);
      cy.scrollTo(&quot;bottom&quot;);
      cy.get('[data-testid=&quot;connect-stripe-button&quot;]').should(&quot;not.exist&quot;);
      cy.contains(&quot;Your Stripe account is already connected&quot;).should(
        &quot;be.visible&quot;,
      );
    });
  });

  describe(&quot;Product Management&quot;, () =&gt; {
    beforeEach(() =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).click({ force: true });
      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();
      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
    });

    it(&quot;should create a new product&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;My Products&quot;).click({ force: true });
      cy.url().should(&quot;include&quot;, &quot;/myproduct&quot;, { timeout: 10000 });

      cy.contains(&quot;Create a vendor account before creating products&quot;).should(
        &quot;not.exist&quot;,
      );
      cy.contains(&quot;button&quot;, &quot;Create&quot;).should(&quot;be.visible&quot;).click();
      cy.get('[role=&quot;dialog&quot;]', { timeout: 10000 }).should(&quot;be.visible&quot;);

      cy.get('[role=&quot;dialog&quot;]').within(() =&gt; {
        cy.get(&quot;input#title&quot;).type(&quot;Cypress Test Product&quot;);
        cy.get(&quot;input#description&quot;).type(&quot;Product for E2E testing orders&quot;);
        cy.get(&quot;input#price&quot;).clear().type(&quot;50.00&quot;);
        cy.get('button[role=&quot;combobox&quot;]').click();
      });

      cy.wait(500);
      cy.get('[role=&quot;option&quot;]').contains(&quot;Video editing&quot;).click();

      cy.get('[role=&quot;dialog&quot;]').within(() =&gt; {
        cy.contains(&quot;button&quot;, &quot;Create&quot;).click();
      });

      cy.wait(1000);
      cy.contains(&quot;Cypress Test Product&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;$50.00&quot;).should(&quot;be.visible&quot;);
    });

    it(&quot;should view product details&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Browse&quot;).click({ force: true });
      cy.url().should(&quot;include&quot;, &quot;/browse&quot;);

      clickViewDetailsFor(&quot;Cypress Test Product&quot;);
      cy.url().should(&quot;include&quot;, &quot;/product/&quot;);

      cy.contains(&quot;Cypress Test Product&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;$50.00&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;Product for E2E testing orders&quot;).should(&quot;be.visible&quot;);
      cy.contains(&quot;button&quot;, &quot;Order Now&quot;).should(&quot;be.visible&quot;);
    });
  });

  describe(&quot;Browse Products&quot;, () =&gt; {
    beforeEach(() =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).click({ force: true });
      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();
      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
    });

    it(&quot;should navigate to browse page and view products&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Browse&quot;).click({ force: true });

      cy.url().should(&quot;include&quot;, &quot;/browse&quot;, { timeout: 10000 });
      cy.get('a[href*=&quot;/product/&quot;]').should(&quot;have.length.greaterThan&quot;, 0);
    });

    it(&quot;should filter products by category&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Browse&quot;).click({ force: true });

      cy.get(&quot;body&quot;).then(($body) =&gt; {
        if ($body.find('[data-testid=&quot;category-filter&quot;]').length &gt; 0) {
          cy.get('[data-testid=&quot;category-filter&quot;]').select(&quot;Video editing&quot;);
          cy.wait(1000);
          cy.get('a[href*=&quot;/product/&quot;]').should(&quot;exist&quot;);
        }
      });
    });
  });

  describe(&quot;Order Creation and Management&quot;, () =&gt; {
    beforeEach(() =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).click({ force: true });
      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();
      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
    });

    it(&quot;should create an order via API&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Browse&quot;).click({ force: true });

      clickViewDetailsFor(&quot;Cypress Test Product&quot;);
      cy.url().should(&quot;include&quot;, &quot;/product/&quot;);

      cy.url().then((url) =&gt; {
        const productId = url.split(&quot;/product/&quot;)[1];

        return getCurrentUser().then((userId) =&gt; {
          return createOrderRequest({
            description: &quot;Test order - need video editing for my project&quot;,
            prof_id: userId,
            productId: productId,
            userId: userId,
          }).then((response) =&gt; {
            expect(response.status).to.eq(201);
            expect(response.body).to.have.property(&quot;message&quot;);
          });
        });
      });
    });

    it(&quot;should view order as customer in My Cart&quot;, () =&gt; {
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;My Cart&quot;).click({ force: true });
      cy.url().should(&quot;include&quot;, &quot;/myorderslist&quot;);
      cy.wait(2000);

      cy.get(&quot;body&quot;).then(($body) =&gt; {
        if (!$body.text().includes(&quot;Once the professional accepts&quot;)) {
          cy.contains(&quot;Cypress Test Product&quot;).should(&quot;be.visible&quot;);
          cy.contains(&quot;Test order&quot;).should(&quot;be.visible&quot;);
        } else {
          cy.contains(&quot;Once the professional accepts&quot;).should(&quot;be.visible&quot;);
        }
      });
    });
  });
  describe(&quot;Error Handling&quot;, () =&gt; {
    it(&quot;should handle non-existent product gracefully&quot;, () =&gt; {
      cy.visit(&quot;localhost:3000&quot;);
      cy.get('[data-testid=&quot;menu-toggle&quot;]').click();
      cy.contains(&quot;Login&quot;).click({ force: true });
      cy.get('input[name=&quot;email&quot;]').type(email);
      cy.get('input[name=&quot;password&quot;]').type(password);
      cy.contains(&quot;button&quot;, &quot;Sign in&quot;).click();
      cy.url().should(&quot;eq&quot;, &quot;http://localhost:3000/&quot;, { timeout: 10000 });
      cy.visit(&quot;localhost:3000/product/non-existent-product-id&quot;);
      cy.wait(2000);
      cy.get(&quot;body&quot;).should(&quot;contain.text&quot;, &quot;not found&quot;);
    });
  });
});
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
