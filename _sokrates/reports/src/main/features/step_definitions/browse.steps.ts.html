<html>
<head>
    <title>features/step_definitions/browse.steps.ts</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">features/step_definitions/browse.steps.ts (<b>71</b> lines of code) (<a href="browse.steps.ts">raw</a>):</h3>
<div id="editor">import assert from &quot;assert&quot;;
import {
  After,
  Before,
  DataTable,
  Given,
  Then,
  When,
} from &quot;@cucumber/cucumber&quot;;
import { browseService, ProductRecord } from &quot;../support/browseService.ts&quot;;

type BrowseWorld = {
  products: ProductRecord[] | null;
};

Before(function (this: BrowseWorld) {
  this.products = null;
});

After(async function () {
  await browseService.cleanup();
});

Given(
  &quot;the catalogue contains the following products:&quot;,
  async function (table: DataTable) {
    await browseService.seedProducts(table.hashes());
  },
);

When(&quot;I fetch the browse catalogue&quot;, async function (this: BrowseWorld) {
  this.products = await browseService.listProducts();
});

When(
  &quot;I filter the browse catalogue by {string}&quot;,
  async function (this: BrowseWorld, category: string) {
    this.products = await browseService.listProducts(category);
  },
);

Then(
  &quot;I should see {int} products&quot;,
  function (this: BrowseWorld, expectedCount: number) {
    assert.ok(this.products, &quot;No catalogue data was captured&quot;);
    assert.strictEqual(this.products.length, expectedCount);
  },
);

Then(
  &quot;the product titles should include:&quot;,
  function (this: BrowseWorld, table: DataTable) {
    assert.ok(this.products, &quot;No catalogue data was captured&quot;);
    const expectedTitles = table
      .hashes()
      .map((row) =&gt; row.title)
      .filter(Boolean);
    const actualTitles = this.products.map((product) =&gt; product.title);
    for (const title of expectedTitles) {
      assert.ok(
        actualTitles.includes(title),
        `Expected &quot;${title}&quot; to be in the catalogue`,
      );
    }
  },
);

Then(
  &quot;every product category should be {string}&quot;,
  function (this: BrowseWorld, category: string) {
    assert.ok(this.products, &quot;No catalogue data was captured&quot;);
    for (const product of this.products) {
      assert.strictEqual(product.category, category);
    }
  },
);

Then(&quot;I should be told there are no products&quot;, function (this: BrowseWorld) {
  assert.ok(this.products, &quot;No catalogue data was captured&quot;);
  assert.strictEqual(this.products.length, 0);
});
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/typescript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
